﻿@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/string-similarity@4.0.4/umd/string-similarity.min.js"></script>
    <link rel="stylesheet" href="/css/leitor.css">
    <style>
        .palavra-incorreta {
            color: red;
        }
    </style>
    <style>
        body {
            background: #f8efed;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            height: auto;
        }

        .container {
            height: 100%;
            width: 100%;
        }

        .custom-div {
            min-height: 200px;
            min-width: 300px;
        }

        #InsiraNome {
            height: 100%;
            width: 100%;
        }

        html {
            height: 100%;
        }

        .cardo {
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

            .cardo:hover {
                transform: scale(1.05);
            }

    </style>

</head>

<body style="background-color:#f8efed;">




    <!--seção ok-->

    <section style="display: block; position:fixed;" id="InsiraNome">
        <div class="container d-flex justify-content-center align-items-center">
            <div class="cardo">
                <div class="mt-5 d-flex justify-content-center" style="font-family: 'Poppins', sans-serif; color:#002060;">
                    <h1>ESCREVA SEU NOME:</h1>
                </div>

                <div class="mt-5">
                    <div class="col">
                        <div class="bg text-dark p-4 custom-div text-center" style="background-color:#FFC938; border-radius:15px;-webkit-box-shadow: 4px 5px 93px -12px rgba(255,239,15,1);-moz-box-shadow: 4px 5px 93px -12px rgba(255,239,15,1);box-shadow: 4px 5px 93px -12px rgba(255,239,15,1);">
                            <br>
                            <br>
                            <div class="input-group mb-3 d-flex justify-content-center align-items-center">
                                <input type="text" class="form-control" id="name" placeholder="Escreva seu Nome" aria-label="Recipient's username" aria-describedby="button-addon2">
                                <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="Nome()" style="background-color:#002060;">Inserir</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>






    <div class="container-fluid">
        <div class="row">

            <section id="Leitura" style="display: none;">
                <div class="col">
                    <div style="background-color:#002060; color:white;font-family: 'Poppins', sans-serif;border-radius:10px;">
                        <h1 class="text-center mt-4" style="font-size:4rem">Hora da Leitura</h1>
                        @* <div style="display:flex; align-items:center; justify-content: flex-end;">s
                        <a href="/home" class="btn" style="background: #FFA500;">voltar</a>
                        </div>*@
                    </div>
                    <div id="jogador" class="text-center mt-3" style="color:#002060;"></div>
                    <h3 class='text-center' id="titulo" style="font-family:'Poppins', sans-serif;margin-top:40px;color:#002060;font-size:25px">@ViewBag.HistoriaAtualizar?.hist_Titulo</h3>
                    <div class="row gap-5 mt-3 justify-content-center align-items-center">
                        <div class="col-md-5">
                            <!-- Conteúdo da primeira div -->
                            <div class="bg-light text-dark p-4 custom-div text-center" id="div1" style="border:dashed #FFA500 2px;font-family:'Poppins', sans-serif;"><h4 id="texto">@ViewBag.HistoriaAtualizar?.Hist_trecho</h4></div>
                        </div>
                        <div class="col-md-5">
                            <!-- Conteúdo da segunda div -->
                            <div class="bg-light text-dark p-4 custom-div text-center" id="resultado" style="border:dashed #FFA500 2px;font-family:'Poppins', sans-serif;"></div>
                        </div>
                        <div class="buttons mt-5 gap-3 d-flex justify-content-center">
                            <button id="BtnmicOn" class="btn" style="background: #FFA500;" data-bs-target="#exampleModal6" data-bs-toggle="modal">
                                <i class="material-icons">mic</i>
                            </button>
                            <style>
                                #BtnmicOff, #BtnmicOn, #recomecar {
                                    transition: .3s;
                                }

                                    #BtnmicOff:active, #BtnmicOn:active, #recomecar:active {
                                        color: white;
                                        transform: scale(0.8)
                                    }
                            </style>
                            <button id="BtnmicOff" disabled class="btn" style="background:#FFA500; display:none;" data-bs-target="#exampleModal7" data-bs-toggle="modal">
                                <i class="material-icons">mic_off</i>
                            </button>

                            <button id="recomecar" onclick="recomecar()" class="btn" style="display:none;">
                                Recomeçar
                            </button>

                            <!-- <button id="BtnDownload" class="btn">
                              <i class="material-icons">download</i>
                            </button> -->
                            <!-- <button id="BtnDelete" class="btn">
                              <i style="color: red;" class="material-icons">delete</i>
                            </button> -->
                            <!-- <button id="BtnVoiceOn" class="btn">
                              <i class="material-icons">record_voice_over</i>
                            </button>
                            <button id="BtnVoiceOff" class="btn">
                              <i class="material-icons">voice_over_off</i>
                            </button> -->
                            <!-- <button id="BtnCorrigir" class="btn">
                              Corrigir
                            </button> -->
                            <!-- <Select id="VoiceOptions"></Select> -->

                        </div>
                    </div>
                </div>

            </section>
        </div>
        <div class="row mt-5">
            <section id="ResultadoGeral" style="display: none;">
                <div class="container">
                    <h1 class="text-center mt-5" style="font-family: 'Poppins', sans-serif; background-color:#002060; color:white;border-radius:10px;font-size:4rem">Resultados</h1>
                    <form action="/Leitura/Resultado" method="post">
                        <div class="row gap-5 mt-5 justify-content-center align-items-center">
                            <div class="col-md-5">
                                <!-- Conteúdo da primeira div -->
                                <div class="bg-light text-dark p-4 custom-div text-center" id="resultadoDiv" style=" border:dashed #FFA500 2px; font-family:'Poppins', sans-serif;">
                                    conteudo aqui
                                </div>
                            </div>
                            <div class="col-md-5">
                                <!-- Conteúdo da segunda div -->
                                <div class="bg-light text-dark p-4 custom-div text-center" id="ResultadoEmPorcentagem" style=" border:dashed #FFA500 2px;font-family:'Poppins', sans-serif;">
                                    conteudo aqui
                                </div>
                            </div>
                               <div class="col-md-5">
                                <!-- Conteúdo da segunda div -->
                                <div class="bg-light text-dark p-4 custom-div text-center" id="Acertos" style=" border:dashed #FFA500 2px;font-family:'Poppins', sans-serif;">
                                    conteudo aqui
                                </div>
                            </div>
                            <div class="col-md-5">
                                <!-- Conteúdo da segunda div -->
                                <div class="bg-light text-dark p-4 custom-div text-center" id="Erros" style=" border:dashed #FFA500 2px;font-family:'Poppins', sans-serif;">
                                    conteudo aqui
                                </div>
                            </div>
                        </div>
                        <div class="mt-5 gap-3 d-flex justify-content-center">
                            <button type="button" id="Button" style="display:none;" onclick="resultadoLa()" class="btn btn-dark" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">Enviar Resultados</button>
                            <style>
                                #Button {
                                    background-color: #FFA500;
                                    transition: .3s;
                                }

                                    #Button:hover {
                                        background: linear-gradient(0deg,#FFA500,#F4F075);
                                        box-shadow: inset 0px 1px 0px 0px rgba(255, 255, 255, 0.4), inset 0px -4px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 4px rgba(255, 255, 255, 0.2), 0px 0px 180px 0px #F58E0B;
                                        transform: translateY(-2px);
                                    }

                                #recomecar {
                                    background-color: #FFA500;
                                    transition: .3s;
                                }

                                    #recomecar:hover {
                                        color: white;
                                        background: linear-gradient(0deg,#FFA500,#F4F075);
                                        box-shadow: inset 0px 1px 0px 0px rgba(255, 255, 255, 0.4), inset 0px -4px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 4px rgba(255, 255, 255, 0.2), 0px 0px 180px 0px #F58E0B;
                                        transform: translateY(-2px);
                                    }
                            </style>
                        </div>
                    </form>

                </div>
            </section>
        </div>

    </div>

    <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalToggleLabel">Deseja Enviar os Seus Resultados?</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="mensagemfoda">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
                    <button class="btn btn-primary" data-bs-dismiss="modal" aria-label="Close" onclick="teste4()">Sim</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Insira o Numero abaixo(Ex: 79988121941)</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="esseeonumero" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="close" onclick="enviarMensagemWhatsApp()">Enviar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal6" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel5">Deseja Iniciar a Gravação?</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                @*   <div class="modal-body" id="resultadodamsgla">
                ...
                </div>*@
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="grava()" @*data-bs-target="#exampleModalToggle3" data-bs-toggle="modal"*@>Sim</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exampleModal7" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel5">Deseja Parar a Gravação?</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                @*  <div class="modal-body" id="resultadodamsgla">
                ...
                </div>*@
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="paragravar()" @*data-bs-target="#exampleModalToggle3" data-bs-toggle="modal"*@>Sim</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exampleModal5" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel5">Deseja Usar Esses Resultados?</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="resultadodamsgla">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="infos()" @*data-bs-target="#exampleModalToggle3" data-bs-toggle="modal"*@>Sim</button>
                </div>
            </div>
        </div>
    </div>

    @*    <div class="modal fade" id="exampleModalToggle3" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
    <div class="modal-header">
    <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Insira o Numero abaixo(Ex: 79988121941)</h1>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
    <div class="input-group mb-3">
    <input type="text" class="form-control" id="esseeonumero" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
    </div>
    </div>
    <div class="modal-footer">
    <button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="close" onclick="enviarMensagemWhatsApp()">Enivar</button>
    </div>
    </div>
    </div>
    </div>*@

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/js/script.js"></script>

    <script>



        function corrigirTexto() {

            document.getElementById('resultadoDiv').innerHTML = `


                    <div class="spinner-border" role="status">
                  <span class="sr-only"></span>
                </div>
                `

            document.getElementById('ResultadoEmPorcentagem').innerHTML = `


                    <div class="spinner-border" role="status">
                  <span class="sr-only"></span>
                </div>`



            document.getElementById('Acertos').innerHTML = `


                            <div class="spinner-border" role="status">
                          <span class="sr-only"></span>
                        </div>
                        `

            document.getElementById('Erros').innerHTML = `


                            <div class="spinner-border" role="status">
                          <span class="sr-only"></span>
                        </div>`


            var textToCheck = document.getElementById('resultado');
            var url = 'https://api.languagetool.org/v2/check';
            $.ajax({
                type: "POST",
                url: url,
                data: {
                    language: 'pt-BR',
                    text: textToCheck.textContent.replace(/[,.?!]/g, '')
                },
                success: function (data) {

                    if (data.matches && data.matches.length > 0) {
                        var textoCorrigido = textToCheck.textContent; // Comece com o texto original
                        var teste = ''

                        data.matches.forEach(function (match, index) {
                            var offset = match.offset;
                            var length = match.length;
                            var texto = match.context.text;
                            var palavraIncorreta = texto.substr(offset, length);
                            teste += " " + palavraIncorreta + ". "
                            textoCorrigido = textoCorrigido.replace(palavraIncorreta, '<span class="palavra-incorreta">' + palavraIncorreta + '</span>');
                        });
                        var teste2 = teste
                        // Define o conteúdo do elemento div como o texto corrigido
                        document.getElementById('resultado').innerHTML = `<h4>${textoCorrigido}</h4>`;
                        document.getElementById('resultadoDiv').innerHTML = `<h4>Palavras Incorretas Detectadas: ${teste2}</h4>`
                        calcularSemelhanca()
                        
                    } else {
                        document.getElementById('resultadoDiv').innerHTML = '<h4>Nenhum Error Ortografico Encontrado Parabéns!'
                        calcularSemelhanca()
                        
                    }
                },
                error: function (erro) {
                    console.log(erro);
                }
            });


        }

    </script>

    <script>

        function resultadoLa() {
            var ResultadoEmPorcentagem = document.getElementById('ResultadoEmPorcentagem').textContent

            var name = document.getElementById('name').value;

            var mensagem = `Seu Aluno: ${name} \n teve ${ResultadoEmPorcentagem} `

            document.getElementById('mensagemfoda').innerHTML = `<p>${mensagem}</p>`
        }

        function Nome() {

            var name = document.getElementById('name').value;

            if (name == null || name == ' ' || name == '') {
                alert('Insira um nome antes de começar');
            } else {
                document.getElementById('InsiraNome').style.display = 'none'
                document.getElementById('Leitura').style.display = 'block'
            }
            document.getElementById('jogador').innerHTML = `<h4 class='text-center' style='text-align:center; margin-top: 20px;'>Leitor: ${name}</h4>`

        }

        function recomecar() {

            document.getElementById('resultado').innerHTML = ''
            document.getElementById('ResultadoGeral').style.display = 'none'
            document.getElementById('BtnmicOn').style.display = 'block'
            document.getElementById('recomecar').style.display = 'none'

        }


        // URL fornecida
        const urlString = (decodeURIComponent(window.location.href))

        // Crie um objeto URL a partir da string da URL
        const url = new URL(urlString);

        // Use a API URLSearchParams para obter os parâmetros da URL
        const params = new URLSearchParams(url.search);

        // Obtenha o valor do título, autor e texto
        const titulo = params.get("titulo");
        const texto = params.get("texto");
        const numero = params.get("numero")
        const passe = params.get("passe")
        var titulotxt = document.getElementById('titulo')
        var textotxt = document.getElementById('texto')
        document.getElementById('esseeonumero').value = numero
        document.addEventListener("DOMContentLoaded", (event) => {
            if (titulo == null) {
                return
            } else {
                titulotxt.innerHTML = titulo
                textotxt.innerHTML = texto
            }
        });

        function teste4() {
            if (numero == " 55null") {
                document.getElementById('esseeonumero').value = ''
                const myModal = new bootstrap.Modal(document.getElementById('exampleModalToggle2'));
                myModal.show();
            } else {
                enviarMensagemWhatsApp()
            }

        }

        function enviarMensagemWhatsApp() {
            if (numero == " 55null" && document.getElementById('esseeonumero').value == " 55null") {
                const myModal = new bootstrap.Modal(document.getElementById('exampleModalToggle'));
                myModal.show();

                return
            } else if (document.getElementById('esseeonumero').value == null || document.getElementById('esseeonumero').value == '' || document.getElementById('esseeonumero').value == ' ') {
                alert('Digite um Número!')
                return
            }

            var ResultadoEmPorcentagem = document.getElementById('ResultadoEmPorcentagem').textContent

            var name = document.getElementById('name').value;

            var mensagem = `Seu Aluno: ${name} \n teve ${ResultadoEmPorcentagem} `
            var goku = document.getElementById('esseeonumero').value
            console.log(goku)

            var url = "https://api.whatsapp.com/send?phone=" + `+55${goku}` + "&text=" + encodeURIComponent(mensagem);
            window.open(url, "_blank");



        }


        function compararTextos() {
            // Obter o conteúdo das divs
            const divTextoOriginal = document.getElementById('div1');
            const divTextoReconhecido = document.getElementById('resultado');

            // Obter o texto de cada div e converter para minúsculas
            const textoOriginal = (divTextoOriginal.textContent || divTextoOriginal.innerText).toLowerCase();
            const textoReconhecido = (divTextoReconhecido.textContent || divTextoReconhecido.innerText).toLowerCase();

            // Converter o texto em arrays de palavras
            const palavrasTextoOriginal = textoOriginal.split(' ');
            const palavrasTextoReconhecido = textoReconhecido.split(' ');

            // Encontrar palavras presentes em ambos os textos
            const palavrasComuns = palavrasTextoOriginal.filter(palavra =>
                palavrasTextoReconhecido.includes(palavra)
            ).join(', ');

            // Encontrar palavras que estão no texto original, mas não no texto Reconhecimento
            const palavrasNaoEncontradas = palavrasTextoOriginal.filter(palavra =>
                !palavrasTextoReconhecido.includes(palavra)
            ).join(', ');

            // Fazer algo com as palavras encontradas e não encontradas
            document.getElementById('Acertos').innerHTML = `<h4>Acertos: ${palavrasComuns}<h4>`
            document.getElementById('Erros').innerHTML = `<h4>Erros: ${palavrasNaoEncontradas}<h4>`
        }



        function infos() {
            const div1Text = document.getElementById('div1').textContent;
            const div2Text = document.getElementById('resultado').textContent;
            const similarity = stringSimilarity.compareTwoStrings(div1Text, div2Text);
            const similarityPercentage = (similarity * 100).toFixed(2);
            var name = document.getElementById('name').value;
            const urlString = (decodeURIComponent(window.location.href))

            // Crie um objeto URL a partir da string da URL
            const url = new URL(urlString);

            // Use a API URLSearchParams para obter os parâmetros da URL
            const params = new URLSearchParams(url.search);

            const login = params.get("login")
            $.ajax({
                url: '/Professor/rank',
                method: 'POST',
                data: {
                    nota: similarityPercentage,
                    name: name,
                    login: login
                },
                success: function (result) {
                    console.log('Deu Certo');
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }



    </script>

    <script>

        function calcularSemelhanca() {

            const div1Text = document.getElementById('div1').textContent.replace(/[,.?!]/g, '');
            const div2Text = document.getElementById('resultado').textContent.replace(/[,.?!]/g, '');


            const similarity = stringSimilarity.compareTwoStrings(div1Text, div2Text);


            const similarityPercentage = (similarity * 100).toFixed(2);

            const resultadoElement = document.getElementById('ResultadoEmPorcentagem');
            if (parseFloat(similarityPercentage) < 60) {
                resultadoElement.style.background = 'red'
                resultadoElement.innerHTML = `<h4>semelhança entre os textos de ${similarityPercentage}%.
                                                          Precisamos Melhorar!
                                                          </h4>`;
                document.getElementById('Button').style.display = 'block'
                compararTextos()
            } else {
                resultadoElement.style.background = 'green'
                resultadoElement.innerHTML = `<h4>semelhança entre os textos de ${similarityPercentage}%.
                                                          Parábens!
                                                          </h4>`;
                document.getElementById('Button').style.display = 'block'


                compararTextos()

            }
            document.getElementById('resultadodamsgla').innerHTML = `<p>Resultado: ${similarityPercentage}</p>`

            if (passe != 1) {
                ativarModal()
            }


        }
        function ativarModal() {
            const myModal = new bootstrap.Modal(document.getElementById('exampleModal5'));
            myModal.show();
        }

    </script>
</body>
</html>